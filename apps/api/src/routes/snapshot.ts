import { Router } from 'express';\nimport { getDb } from '../lib/mongo';\nexport const snapshotRouter = Router();\n// POST /snapshot/holders { items: [{owner, mint}] }\nsnapshotRouter.post('/holders', async (req,res)=>{\n  try{\n    const db = await getDb();\n    const items = Array.isArray(req.body?.items) ? req.body.items : [];\n    if(!items.length) return res.status(400).json({error:'no items'});\n    await db.collection('holders').insertMany(items.map((i:any)=>({ ...i, ts: new Date() })));\n    res.json({ inserted: items.length });\n  }catch(e:any){ res.status(500).json({error:e.message}); }\n});\n// POST /snapshot/market { market, positions:[{owner, yes_bal, no_bal}] }\nsnapshotRouter.post('/market', async (req,res)=>{\n  try{\n    const db = await getDb();\n    const { market, positions } = req.body || {};\n    if(!market || !Array.isArray(positions)) return res.status(400).json({error:'bad payload'});\n    await db.collection('positions').insertMany(positions.map((p:any)=>({ market, ...p, ts:new Date() })));\n    res.json({ inserted: positions.length });\n  }catch(e:any){ res.status(500).json({error:e.message}); }\n});\n
